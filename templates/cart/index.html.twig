{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-5">

    <h2>ÉTAPE 1 - DATE DE RÉSERVATION</h2>

    {{ form_start(reservationForm) }}
    
    <div class="mb-3">
        {{ form_label(reservationForm.boutique, 'Choix de la boutique *') }}
        {{ form_widget(reservationForm.boutique) }}
        {{ form_errors(reservationForm.boutique) }}
    </div>

  <div class="mb-3">
    {{ form_label(reservationForm.dateRetrait, 'Date de retrait du matériel *') }}
    {{ form_widget(reservationForm.dateRetrait, {'id': 'date-retrait'}) }}
    {{ form_errors(reservationForm.dateRetrait) }}
</div>

<div class="mb-3">
    {{ form_label(reservationForm.dateRetour, 'Date de retour du matériel *') }}
    {{ form_widget(reservationForm.dateRetour, {'id': 'date-retour'}) }}
    {{ form_errors(reservationForm.dateRetour) }}
</div>


<!-- ETAPE 2 : BON DE COMMANDE -->
<h2 class="mt-4">ÉTAPE 2 - BON DE COMMANDE</h2>

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>QTY</th>
            <th>ARTICLE</th>
            <th>PRIX UNITAIRE</th>
            <th>TOTAL</th>
            <th>ACTION</th>
        </tr>
    </thead>
    <tbody>
        <!-- Loop through the products in the cart using Twig -->
        {% for item in dataPanier %}
        <tr>
    <td>{{ item.product.id }}</td>
    <td>
    <input 
        type="number" 
        value="{{ item.quantity }}" 
        name="product_quantity[{{ item.product.id }}]" 
        class="form-control product-quantity" 
        id="product-quantity-{{ item.product.id }}" 
        data-product-id="{{ item.product.id }}" 
        data-price="{{ item.product.prixLocation }}">
</td>

    <td>{{ item.product.nom }}</td>
    <td>{{ item.product.prixLocation }} €</td>
    <td>
        <span id="total-price-{{ item.product.id }}">{{ item.product.prixLocation * item.quantity }}</span> €
    </td>
    <td>
        <a href="{{ path('cart_add', {id: item.product.id}) }}" class="btn btn-success"><i class="bi bi-cart-plus"></i></a>
        <a href="{{ path('cart_remove', {id: item.product.id}) }}" class="btn btn-warning"><i class="bi bi-cart-dash"></i></a>
        <a href="{{ path('cart_delete', {id: item.product.id}) }}" class="btn btn-danger"><i class="bi bi-cart-x"></i></a>
    </td>
</tr>
        {% else %}
        <tr>
            <td colspan="5" class="text-center">Votre panier est vide</td>
        </tr>
        {% endfor %}
        <!-- Ajouter une nouvelle ligne pour le total cumulé -->
        <tr>
            <td colspan="4" class="text-right"><strong>Total général :</strong></td>
            <td>
            <span id="total-general">{{ totalGeneral | number_format(2) }}</span> €
            </td>
            <td></td>
        </tr>
    </tbody>
</table>

  {{ form_widget(reservationForm._token) }}
      <div class="mt-4">
      <td>
   
</td>

    </div>
        
    <div class="mb-3">
        {{ form_label(reservationForm.prenom, 'Prénom *') }}
        {{ form_widget(reservationForm.prenom) }}
        {{ form_errors(reservationForm.prenom) }}
    </div>

    <div class="mb-3">
        {{ form_label(reservationForm.nom, 'Nom *') }}
        {{ form_widget(reservationForm.nom) }}
        {{ form_errors(reservationForm.nom) }}
    </div>

    <!-- Champ Société (facultatif) -->
    <div class="mb-3">
        {{ form_label(reservationForm.societe, 'Société (facultatif)') }}
        {{ form_widget(reservationForm.societe) }}
        {{ form_errors(reservationForm.societe) }}
    </div>

    <!-- Champ Numéro TVA (facultatif) -->
    <div class="mb-3">
        {{ form_label(reservationForm.numeroTVA, 'Numéro TVA (facultatif)') }}
        {{ form_widget(reservationForm.numeroTVA) }}
        {{ form_errors(reservationForm.numeroTVA) }}
    </div>

    <!-- Champ Email -->
    <div class="mb-3">
        {{ form_label(reservationForm.email, 'Email *') }}
        {{ form_widget(reservationForm.email) }}
        {{ form_errors(reservationForm.email) }}
    </div>

    <!-- Champ Adresse de facturation -->
    <div class="mb-3">
        {{ form_label(reservationForm.adresse, 'Adresse de facturation *') }}
        {{ form_widget(reservationForm.adresse) }}
        {{ form_errors(reservationForm.adresse) }}
    </div>

    <!-- Champ Ville -->
    <div class="mb-3">
        {{ form_label(reservationForm.ville, 'Ville *') }}
        {{ form_widget(reservationForm.ville) }}
        {{ form_errors(reservationForm.ville) }}
    </div>

    <!-- Champ Code postal -->
    <div class="mb-3">
        {{ form_label(reservationForm.codePostal, 'Code postal *') }}
        {{ form_widget(reservationForm.codePostal) }}
        {{ form_errors(reservationForm.codePostal) }}
    </div>

    <!-- Champ Téléphone -->
    <div class="mb-3">
        {{ form_label(reservationForm.telephone, 'Téléphone *') }}
        {{ form_widget(reservationForm.telephone) }}
        {{ form_errors(reservationForm.telephone) }}
    </div>

    <!-- Champ AccepteConditions -->
    <div class="form-check mb-3">
        {{ form_widget(reservationForm.accepteConditions) }}
        {{ form_label(reservationForm.accepteConditions, 'Je valide les conditions générales d\'utilisation (nouvelle version en date du 03/04/2023)') }}
        {{ form_errors(reservationForm.accepteConditions) }}
    </div>
    
<form action="{{ path('cart_reservation') }}" method="POST">
    <button type="submit" class="btn btn-success">ENVOYER MA DEMANDE DE LOCATION</button>
</form>
  
</div>
{% block javascripts %}

{% endblock %}

{% endblock %}

